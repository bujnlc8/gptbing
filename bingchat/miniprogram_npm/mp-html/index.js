"use strict";function e(t){"@babel/helpers - typeof";return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,r){return t=n(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(t){var n=r(t,"string");return"symbol"===e(n)?n:String(n)}function r(t,n){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,n||"default");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}function o(e){return a.forEach(function(t){var n=e.match(new RegExp("<"+t+".*>"));null!=n&&n.forEach(function(t){e=e.replace(t,t.replace("<","&lt;").replace(">","&gt;"))}),-1!=e.indexOf("</"+t+">")&&(e=e.replace("</"+t+">","&lt;/"+t+"&gt;"))}),e}/*!
 * mp-html v2.4.1
 * https://github.com/jin-yufeng/mp-html
 *
 * Released under the MIT license
 * Author: Jin Yufeng
 */
var i=require("./parser"),a=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],l=[require("./markdown/index.js"),require("./emoji/index.js"),require("./highlight/index.js"),require("./latex/index.js"),require("./style/index.js")];Component({data:{nodes:[]},properties:{markdown:Boolean,containerStyle:String,content:{type:String,value:"",observer:function(e){e=e.replaceAll("\nabla","\\nabla").replaceAll("\nearrow","\\nearrow").replaceAll("\nwarrow","\\nwarrow").replaceAll("\natural","\\natural").replaceAll("\notin","\\notin"),this.setContent(e)}},copyLink:{type:Boolean,value:!0},domain:String,errorImg:String,lazyLoad:Boolean,loadingImg:String,pauseVideo:{type:Boolean,value:!0},previewImg:{type:Boolean,value:!0},scrollTable:Boolean,selectable:null,setTitle:{type:Boolean,value:!0},showImgMenu:{type:Boolean,value:!0},tagStyle:Object,useAnchor:null},created:function(){this.plugins=[];for(var e=l.length;e--;)this.plugins.push(new l[e](this))},detached:function(){this._hook("onDetached")},methods:{in:function(e,t,n){e&&t&&n&&(this._in={page:e,selector:t,scrollTop:n})},navigateTo:function(e,n){var r=this;return e=this._ids[decodeURI(e)]||e,new Promise(function(o,i){if(!r.data.useAnchor)return void i(Error("Anchor is disabled"));var a=wx.createSelectorQuery().in(r._in?r._in.page:r).select((r._in?r._in.selector:"._root")+(e?"".concat(">>>","#").concat(e):"")).boundingClientRect();r._in?a.select(r._in.selector).scrollOffset().select(r._in.selector).boundingClientRect():a.selectViewport().scrollOffset(),a.exec(function(e){if(!e[0])return void i(Error("Label not found"));var a=e[1].scrollTop+e[0].top-(e[2]?e[2].top:0)+(n||parseInt(r.data.useAnchor)||0);r._in?r._in.page.setData(t({},r._in.scrollTop,a)):wx.pageScrollTo({scrollTop:a,duration:300}),o()})})},getText:function(e){var t="";return function e(n){for(var r=0;r<n.length;r++){var o=n[r];if("text"===o.type)t+=o.text.replace(/&amp;/g,"&");else if("br"===o.name)t+="\n";else{var i="p"===o.name||"div"===o.name||"tr"===o.name||"li"===o.name||"h"===o.name[0]&&o.name[1]>"0"&&o.name[1]<"7";i&&t&&"\n"!==t[t.length-1]&&(t+="\n"),o.children&&e(o.children),i&&"\n"!==t[t.length-1]?t+="\n":"td"!==o.name&&"th"!==o.name||(t+="\t")}}}(e||this.data.nodes),t},getRect:function(){var e=this;return new Promise(function(t,n){wx.createSelectorQuery().in(e).select("._root").boundingClientRect().exec(function(e){return e[0]?t(e[0]):n(Error("Root label not found"))})})},pauseMedia:function(){for(var e=(this._videos||[]).length;e--;)this._videos[e].pause()},setPlaybackRate:function(e){this.playbackRate=e;for(var t=(this._videos||[]).length;t--;)this._videos[t].playbackRate(e)},setContent:function(e,t){var n=this;-1!=e.indexOf("python代码")&&-1==e.indexOf("```")&&(e="```\n\n"+e+"\n\n```"),this.imgList&&t||(this.imgList=[]),this._videos=[];var r={},o=new i(this).parse(e);if(t)for(var a=this.data.nodes.length,l=o.length;l--;)r["nodes[".concat(a+l,"]")]=o[l];else r.nodes=o;if(this.setData(r,function(){n._hook("onLoad"),n.triggerEvent("load")}),this.data.lazyLoad||this.imgList._unloadimgs<this.imgList.length/2){var s=0,c=function e(t){t&&t.height||(t={}),t.height===s?n.triggerEvent("ready",t):(s=t.height,setTimeout(function(){n.getRect().then(e).catch(e)},350))};this.getRect().then(c).catch(c)}else this.imgList._unloadimgs||this.getRect().then(function(e){n.triggerEvent("ready",e)}).catch(function(){n.triggerEvent("ready",{})})},_hook:function(e){for(var t=l.length;t--;)this.plugins[t][e]&&this.plugins[t][e]()},_add:function(e){e.detail.root=this}}});